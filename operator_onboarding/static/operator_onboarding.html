<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Operator Onboarding — Immo Snippy</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 560px; margin: 2rem auto; padding: 0 1rem; }
    h1 { font-size: 1.25rem; }
    .step { display: none; }
    .step.active { display: block; }
    .progress { margin: 1rem 0; height: 6px; background: #eee; border-radius: 3px; }
    .progress div { height: 100%; width: 33%; background: #333; border-radius: 3px; transition: width .2s; }
    .progress.step-2 div { width: 66%; }
    .progress.step-3 div { width: 100%; }
    label { display: block; margin-top: 0.75rem; font-weight: 500; }
    input, select, textarea { width: 100%; padding: 0.5rem; margin-top: 0.25rem; box-sizing: border-box; }
    textarea { min-height: 80px; }
    button { margin-top: 1rem; padding: 0.6rem 1.2rem; cursor: pointer; }
    .btns { display: flex; gap: 0.5rem; margin-top: 1rem; }
    .err { color: #c00; font-size: 0.9rem; margin-top: 0.5rem; }
    .ok { color: #080; font-size: 0.9rem; margin-top: 0.5rem; }
  </style>
</head>
<body>
  <h1>Operator Onboarding</h1>
  <p>3-step form → POST /api/operators. Use for testing when the main React app is not available.</p>
  <div class="progress step-1" id="progress"><div></div></div>

  <form id="form">
    <div class="step active" id="step1">
      <h2>Step 1 — Company basics</h2>
      <label>Company name *</label>
      <input name="company_name" required />
      <label>Website URL</label>
      <input name="website_url" type="url" placeholder="https://..." />
      <label>Tagline</label>
      <input name="tagline" />
      <label>Countries (e.g. LU, FR)</label>
      <input name="countries" placeholder="LU, FR" />
      <div class="btns">
        <button type="button" onclick="go(2)">Next</button>
      </div>
    </div>

    <div class="step" id="step2">
      <h2>Step 2 — 5 dropdowns</h2>
      <label>Tone / communication style</label>
      <select name="tone_style">
        <option value="professional_trustworthy">Professional and trustworthy</option>
        <option value="friendly_approachable">Friendly and approachable</option>
        <option value="luxurious_premium">Luxurious and premium</option>
        <option value="direct_results">Direct and results-oriented</option>
        <option value="empathetic_supportive">Empathetic and supportive</option>
        <option value="calm_expert">Calm and expert</option>
      </select>
      <label>Target owner type (ideal client)</label>
      <select name="ideal_client_profile">
        <option value="busy_professionals_expat">Busy professionals and expats</option>
        <option value="investors_portfolio">Real estate investors and portfolio owners</option>
        <option value="retirees_second_home">Retirees and second-home owners</option>
        <option value="first_time_hosts">First-time hosts</option>
        <option value="inherited_owners">Inherited property owners</option>
        <option value="corporate_landlords">Corporate landlords</option>
      </select>
      <label>Preferred property type</label>
      <select name="preferred_property_types">
        <option value="urban_apartments">Urban apartments (high turnover)</option>
        <option value="family_houses_villas">Family houses and villas</option>
        <option value="luxury_unique">Luxury / unique properties</option>
        <option value="rural_countryside">Rural or countryside homes</option>
        <option value="studio_small">Studio / small apartments</option>
        <option value="no_preference">No strong preference</option>
      </select>
      <label>Pricing model</label>
      <select name="pricing_model">
        <option value="20_25_percent">20–25% of booking revenue</option>
        <option value="15_20_percent">15–20% of booking revenue</option>
        <option value="flat_monthly">Flat monthly fee per property</option>
        <option value="hybrid">Hybrid (base + percentage)</option>
        <option value="performance_based_min">Performance-based minimum</option>
      </select>
      <label>Primary service package</label>
      <select name="primary_service_package">
        <option value="full_done_for_you">Full done-for-you management</option>
        <option value="cohosting_only">Co-hosting only</option>
        <option value="setup_launch_only">Setup & launch only</option>
        <option value="revenue_optimization_only">Revenue optimization only</option>
        <option value="legal_compliance_specialist">Legal & compliance specialist</option>
      </select>
      <div class="btns">
        <button type="button" onclick="go(1)">Back</button>
        <button type="button" onclick="go(3)">Next</button>
      </div>
    </div>

    <div class="step" id="step3">
      <h2>Step 3 — Links & notes</h2>
      <label>Calendly link</label>
      <input name="calendly_link" type="url" placeholder="https://calendly.com/..." />
      <label>Qualification rules (text)</label>
      <textarea name="qualification_rules" placeholder="e.g. Always offer 15-min call first"></textarea>
      <label>Notes</label>
      <textarea name="notes"></textarea>
      <div class="btns">
        <button type="button" onclick="go(2)">Back</button>
        <button type="submit">Save → POST /api/operators</button>
      </div>
    </div>
  </form>

  <div id="message" class="err"></div>

  <script>
    let currentStep = 1;
    function go(step) {
      document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
      document.getElementById('step' + step).classList.add('active');
      document.getElementById('progress').className = 'progress step-' + step;
      currentStep = step;
    }
    document.getElementById('form').onsubmit = async function(e) {
      e.preventDefault();
      const msg = document.getElementById('message');
      msg.textContent = '';
      const fd = new FormData(this);
      const primary_service_package = fd.get('primary_service_package');
      const body = {
        company_name: fd.get('company_name'),
        website_url: fd.get('website_url') || undefined,
        tagline: fd.get('tagline') || undefined,
        countries: fd.get('countries') || undefined,
        tone_style: fd.get('tone_style'),
        ideal_client_profile: fd.get('ideal_client_profile'),
        preferred_property_types: fd.get('preferred_property_types'),
        pricing_model: fd.get('pricing_model'),
        qualification_rules: fd.get('qualification_rules') || undefined,
        calendly_link: fd.get('calendly_link') || undefined,
        notes: fd.get('notes') || undefined,
      };
      if (primary_service_package) body.agency_context_ext = { primary_service_package };
      try {
        const r = await fetch('/api/operators', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        const data = await r.json().catch(() => ({}));
        if (r.ok && data.ok) {
          msg.className = 'ok';
          msg.textContent = 'Saved. Operator id: ' + (data.id ?? '—');
        } else {
          msg.className = 'err';
          msg.textContent = data.detail || data.error || 'Request failed ' + r.status;
        }
      } catch (err) {
        msg.className = 'err';
        msg.textContent = err.message;
      }
    };
  </script>
</body>
</html>
